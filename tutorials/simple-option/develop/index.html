<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="CosmWasm Documentation" href="/opensearch.xml"><title data-react-helmet="true">Develop Contract | CosmWasm Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.cosmwasm.com/tutorials/simple-option/develop"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-tutorials-current"><meta data-react-helmet="true" property="og:title" content="Develop Contract | CosmWasm Documentation"><meta data-react-helmet="true" name="description" content="First test if the starter works, and get your eyes used to rust test results:"><meta data-react-helmet="true" property="og:description" content="First test if the starter works, and get your eyes used to rust test results:"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://docs.cosmwasm.com/tutorials/simple-option/develop"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/tutorials/simple-option/develop" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/fr/tutorials/simple-option/develop" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/tutorials/simple-option/develop" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.561bf0c2.css">
<link rel="preload" href="/assets/js/runtime~main.ce7f4cbf.js" as="script">
<link rel="preload" href="/assets/js/main.415ae867.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/0.16/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/dev-academy/intro">Dev Academy</a></li><li><a class="dropdown__link" href="/tutorials/hijack-escrow/intro">Tutorials</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">dApps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cw-plus/0.9.0/overview">cw-plus</a></li></ul></div><a class="navbar__item navbar__link" href="/ecosystem/overview">Ecosystem</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/tutorials/simple-option/develop" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/fr/tutorials/simple-option/develop" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">franÃ§ais</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_3h0W"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Hijack Escrow</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Simple Option</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/simple-option/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/simple-option/setup">Setup</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tutorials/simple-option/develop">Develop Contract</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/simple-option/testing">Testing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/simple-option/next-steps">Next Steps</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/tutorials/governance">Smart Contracts Over Governance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Name Service</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Storage</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Frontend dApp</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/tutorials/videos-workshops">Videos and Workshops</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Develop Contract</h1></header><iframe src="https://player.vimeo.com/video/457702442" width="640" height="360" frameborder="0" allow="autoplay; fullscreen"></iframe><p>First test if the starter works, and get your eyes used to rust test results:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo unit-test</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Compiling proc-macro2 v1.0.24</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling unicode-xid v0.2.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling syn v1.0.58</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling serde_derive v1.0.120</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling serde v1.0.120</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling ryu v1.0.5</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling serde_json v1.0.61</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling schemars v0.7.6</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling itoa v0.4.7</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling base64 v0.13.0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling quote v1.0.8</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling serde_derive_internals v0.25.0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling schemars_derive v0.7.6</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling thiserror-impl v1.0.23</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling cosmwasm-derive v0.13.2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling thiserror v1.0.23</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling serde-json-wasm v0.2.3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling cosmwasm-std v0.13.2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling cosmwasm-schema v0.13.2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling cosmwasm-storage v0.13.2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Compiling simple-option v0.8.0 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">/home/orkunkl/Workspace/cosmwasm/cw-examples/simple-option</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Finished </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">unoptimized + debuginfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> target</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">25</span><span class="token plain">.42s</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      Running target/debug/deps/simple_option-6787c8970c576a03</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">running </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> tests</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> contract::tests::proper_initialization </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> contract::tests::transfer </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> contract::tests::burn </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> contract::tests::execute </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> result: ok. </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> passed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> failed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> ignored</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> measured</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> filtered out</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>All good.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p> Timecode <a href="https://vimeo.com/457702442#t=39s" target="_blank" rel="noopener noreferrer">https://vimeo.com/457702442#t=39s</a></p></div></div><p><a href="https://github.com/CosmWasm/cw-examples/blob/master/simple-option/src/lib.rs" target="_blank" rel="noopener noreferrer">src/lib.rs</a> file contains wasm
bindings. Wraps smart contract <em>(handle, init, query)</em> functions around rust functions. If you are not doing advanced
wasm tweaking, don&#x27;t touch it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="messages"></a>Messages<a class="hash-link" href="#messages" title="Direct link to heading">#</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p> Timecode <a href="https://vimeo.com/457702442#t=1m46s" target="_blank" rel="noopener noreferrer">https://vimeo.com/457702442#t=1m46s</a></p></div></div><p>Development begins in <a href="https://github.com/CosmWasm/cw-examples/blob/master/simple-option/src/msg.rs" target="_blank" rel="noopener noreferrer">src/msg.rs</a>
which contains the input data structures of the smart contract.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="initmsg"></a>InitMsg<a class="hash-link" href="#initmsg" title="Direct link to heading">#</a></h3><p>We will begin with <a href="https://github.com/CosmWasm/cw-examples/blob/master/simple-option/src/msg.rs" target="_blank" rel="noopener noreferrer"><code>InitMsg</code></a>. This
struct has the initial values that initializes smart contract from the code and feeds in the data required for logic
setup.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct InitMsg {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // owner and creator come from env</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // collateral comes from env</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub counter_offer: Vec&lt;Coin&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub expires: u64,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</code> implements specified traits for this structure
using macros. More read <a href="https://doc.rust-lang.org/stable/rust-by-example/trait/derive.html" target="_blank" rel="noopener noreferrer">Rust docs / Derive</a></p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><ul><li><em>Owner</em>, <em>creator</em> and <em>collateral</em> comes from message transaction context, meaning owner and creator is the address
signed the tx and collateral is funds sent along the message.</li><li><em>counter_offer</em> is <a href="https://www.investopedia.com/terms/s/strikeprice.asp" target="_blank" rel="noopener noreferrer">strike price</a>.
:::</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="handlemsg"></a>HandleMsg<a class="hash-link" href="#handlemsg" title="Direct link to heading">#</a></h3><p>Contract execution is branched using <code>HandleMsg</code> enum. Each field defines a message and content of that message.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[serde(rename_all = &quot;snake_case&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum HandleMsg {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /// Owner can transfer to a new owner</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Transfer { recipient: HumanAddr },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /// Owner can post counter_offer on unexpired option to execute and get the collateral</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Execute {},</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /// Burn will release collateral if expired</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Burn {},</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><p> Canonical and Human Addresses Canonical Addresses represent binary format of crypto addresses. Human Addresses
on the other hand are great for the UI. They are always a subset of ascii text, and often contain security checks - such
as chain-prefix in Bech32, e.g. cosmos1h57760w793q6vh06jsppnqdkc4ejcuyrrjxnke</p><p><code>canonicalize(humanize(canonical_addr)) == canonical_addr</code></p><p>For more details: <a href="https://docs.cosmwasm.com/0.14/architecture/addresses" target="_blank" rel="noopener noreferrer">Names and Addresses</a>
:::</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="querymsg"></a>QueryMsg<a class="hash-link" href="#querymsg" title="Direct link to heading">#</a></h3><p>Smart contract state querying is branched using <code>QueryMsg</code> enum. We will implement a smart contract <code>Config</code> query
later.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[serde(rename_all = &quot;snake_case&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum QueryMsg {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Config {},</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="state"></a>State<a class="hash-link" href="#state" title="Direct link to heading">#</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p> Timecode <a href="https://vimeo.com/457702442#t=7m36s" target="_blank" rel="noopener noreferrer">https://vimeo.com/457702442#t=7m36s</a></p></div></div><p><a href="https://github.com/CosmWasm/cw-examples/blob/master/simple-option/src/state.rs" target="_blank" rel="noopener noreferrer">State</a> handles state of the
database where smart contract data is stored and accessed.</p><p>You have two options when modeling state:</p><ol><li><strong>Singleton</strong>: contract saves only one instance of the structure using unique db key. We will use this in this
tutorial.</li><li><strong>Structured store</strong>: models can be structured and stored dynamically. You can form one-to-one, one-to-many and
many-to-many relations with indexing and lookup functionality.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// configuration instance key. config object will be saved under this key.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub static CONFIG_KEY: &amp;[u8] = b&quot;config&quot;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// contract state structure, this will be saved.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct State {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub creator: HumanAddr,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub owner: HumanAddr,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub collateral: Vec&lt;Coin&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub counter_offer: Vec&lt;Coin&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub expires: u64,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn config(storage: &amp;mut dyn Storage) -&gt; Singleton&lt;State&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  singleton(storage, CONFIG_KEY)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn config_read(storage: &amp;dyn Storage) -&gt; ReadonlySingleton&lt;State&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  singleton_read(storage, CONFIG_KEY)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="contract-handlers"></a>Contract Handlers<a class="hash-link" href="#contract-handlers" title="Direct link to heading">#</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p> Timecode <a href="https://vimeo.com/457702442#t=11m12s" target="_blank" rel="noopener noreferrer">https://vimeo.com/457702442#t=11m12s</a></p></div></div><p>Lego bricks <strong>msgs</strong>, <strong>handler</strong> and <strong>state</strong> are defined. Now we need to bind them together
in <a href="https://github.com/CosmWasm/cw-examples/blob/master/simple-option/src/contract.rs" target="_blank" rel="noopener noreferrer">contract.rs</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="init"></a>Init<a class="hash-link" href="#init" title="Direct link to heading">#</a></h3><p>The init function will be called exactly once, before the contract is executed. It is a &quot;privileged&quot; function in that it
can set configuration that can never be modified by any other method call. The first line parses the input from raw
bytes into our contract-defined message. We then check if option is expired, then create the initial state. If expired,
we return a generic contract error, otherwise, we store the state and return a success code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn init(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  env: Env,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  msg: InitMsg,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;InitResponse, ContractError&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if msg.expires &lt;= env.block.height {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return Err(ContractError::OptionExpired {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      expired: msg.expires,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let state = State {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    creator: info.sender.clone(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner: info.sender.clone(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    collateral: info.sent_funds,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    counter_offer: msg.counter_offer,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    expires: msg.expires,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  config(deps.storage).save(&amp;state)?;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(InitResponse::default())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The function is simple as it looks. Option expiration date check, save the state, and return response.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn init(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  env: Env,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  msg: InitMsg,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;InitResponse, ContractError&gt; {</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You will see this signature all over CosmWasm handler functions. Execution context passed in to handler using Deps,
which contains Storage, API and Querier functions; Env, which contains block, message and contract info; and msg, well,
no explanation needed.</p><p><code>Result&lt;T, ContractError&gt;</code> is a type that represents either success ([<code>Ok</code>]) or failure ([<code>Err</code>]). If the execution is
successful returns <code>T</code> type otherwise returns <code>ContractError</code>. Useful.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="handle"></a>Handle<a class="hash-link" href="#handle" title="Direct link to heading">#</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p> Timecode <a href="https://vimeo.com/457702442#t=15m55s" target="_blank" rel="noopener noreferrer">https://vimeo.com/457702442#t=15m55s</a></p></div></div><p><code>handle</code> method routes messages to functions. It is similar to Cosmos SDK handler design.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn handle(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  env: Env,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  msg: HandleMsg,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;HandleResponse, ContractError&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  match msg {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HandleMsg::Transfer { recipient } =&gt; handle_transfer(deps, env, info, recipient),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HandleMsg::Execute {} =&gt; handle_execute(deps, env, info),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HandleMsg::Burn {} =&gt; handle_burn(deps, env, info),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="transfer"></a>Transfer<a class="hash-link" href="#transfer" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn handle_transfer(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _env: Env,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  recipient: HumanAddr,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;HandleResponse, ContractError&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // ensure msg sender is the owner</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let mut state = config(deps.storage).load()?;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if info.sender != state.owner {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return Err(ContractError::Unauthorized {});</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // set new owner on state</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  state.owner = recipient.clone();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  config(deps.storage).save(&amp;state)?;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let mut res = Context::new();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  res.add_attribute(&quot;action&quot;, &quot;transfer&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  res.add_attribute(&quot;owner&quot;, recipient);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(res.into())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="execute"></a>Execute<a class="hash-link" href="#execute" title="Direct link to heading">#</a></h4><p>You will see <code>handle_execute</code> in plus and example smart contracts, but actually it is just a naming, nothing special.
Most of the function is same with <code>transfer</code>. Just two new things: message fund check and sdk messages in return
context.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn handle_execute(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  env: Env,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;HandleResponse, ContractError&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // ensure msg sender is the owner</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let state = config(deps.storage).load()?;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if info.sender != state.owner {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return Err(ContractError::Unauthorized {});</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // ensure not expired</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if env.block.height &gt;= state.expires {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return Err(ContractError::OptionExpired {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      expired: state.expires,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // ensure sending proper counter_offer</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if info.sent_funds != state.counter_offer {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return Err(ContractError::CounterOfferMismatch {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      offer: info.sent_funds,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      counter_offer: state.counter_offer,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // release counter_offer to creator</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let mut res = Context::new();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  res.add_message(BankMsg::Send {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    from_address: env.contract.address.clone(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    to_address: state.creator,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    amount: state.counter_offer,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // release collateral to sender</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  res.add_message(BankMsg::Send {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    from_address: env.contract.address,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    to_address: state.owner,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    amount: state.collateral,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // delete the option</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  config(deps.storage).remove();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  res.add_attribute(&quot;action&quot;, &quot;execute&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(res.into())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="query"></a>Query<a class="hash-link" href="#query" title="Direct link to heading">#</a></h3><p>This contracts query method is very simple, only configuration query. For more complex queries
check <a href="https://github.com/CosmWasm/cw-plus/" target="_blank" rel="noopener noreferrer">cosmwasm-plus</a> contracts. If you are starting to learn from zero, now
you have 20 minutes of cosmwasm experience. Go ahead skim plus contracts to see the simplicity.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn query(deps: Deps, _env: Env, msg: QueryMsg) -&gt; StdResult&lt;Binary&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  match msg {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    QueryMsg::Config {} =&gt; to_binary(&amp;query_config(deps)?),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn query_config(deps: Deps) -&gt; StdResult&lt;ConfigResponse&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let state = config_read(deps.storage).load()?;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(state)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="build"></a>Build<a class="hash-link" href="#build" title="Direct link to heading">#</a></h3><p>To simply build the code and see if it works:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo build</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="tooling"></a>Tooling<a class="hash-link" href="#tooling" title="Direct link to heading">#</a></h3><p>It is good to keep the same coding style across smart contracts for readability and lint it for high code quality:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rustup update</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rustup component </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> clippy rustfmt</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo </span><span class="token function" style="color:rgb(130, 170, 255)">fmt</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Normally Rust compiler does its job great, leads you to the solution for the errors, shows warnings etc. But it is
always good to run linter on the code.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo clippy -- -D warnings</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="compile"></a>Compile<a class="hash-link" href="#compile" title="Direct link to heading">#</a></h3><p>This section compiles key commands from <a href="https://docs.cosmwasm.com/0.14/getting-started/compile-contract" target="_blank" rel="noopener noreferrer">Compiling Contract</a> doc.
For more
detailed read proceed to the documentation.</p><p>Basic compilation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo wasm</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Optimized compilation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">RUSTFLAGS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;-C link-arg=-s&#x27;</span><span class="token plain"> cargo wasm</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Reproducible and optimized compilation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --rm -v </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$(</span><span class="token string variable builtin class-name" style="color:rgb(255, 203, 107)">pwd</span><span class="token string variable" style="color:rgb(191, 199, 213)">)</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token plain">:/code </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">volume,source</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;$(basename &quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$(</span><span class="token string variable builtin class-name" style="color:rgb(255, 203, 107)">pwd</span><span class="token string variable" style="color:rgb(191, 199, 213)">)</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">_cache&quot;,target</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/code/target </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">volume,source</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">registry_cache,target</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/usr/local/cargo/registry </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cosmwasm/rust-optimizer:0.10.7</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You want to use the command above before deploying to the chain.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="schema"></a>Schema<a class="hash-link" href="#schema" title="Direct link to heading">#</a></h3><p>We can also generate JSON Schemas that serve as a guide for anyone trying to use the contract. This is mainly for
documentation purposes, but if you click on &quot;Open TypeScript definitions&quot; in the code explorer, you can see how we use
those to generate TypeScript bindings.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo schema</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see the generated schemas
under <a href="https://github.com/CosmWasm/cw-examples/tree/master/simple-option/schema" target="_blank" rel="noopener noreferrer">simple-option/schema</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€ config_response.json</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€ handle_msg.json</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€ init_msg.json</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â””â”€â”€ query_msg.json</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Go ahead and explore schemas.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/InterWasm/docs/edit/main/tutorials/simple-option/develop.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tutorials/simple-option/setup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Setup</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tutorials/simple-option/testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#messages" class="table-of-contents__link">Messages</a><ul><li><a href="#initmsg" class="table-of-contents__link">InitMsg</a></li><li><a href="#querymsg" class="table-of-contents__link">QueryMsg</a></li></ul></li><li><a href="#state" class="table-of-contents__link">State</a></li><li><a href="#contract-handlers" class="table-of-contents__link">Contract Handlers</a><ul><li><a href="#init" class="table-of-contents__link">Init</a></li><li><a href="#handle" class="table-of-contents__link">Handle</a></li><li><a href="#query" class="table-of-contents__link">Query</a></li><li><a href="#build" class="table-of-contents__link">Build</a></li><li><a href="#tooling" class="table-of-contents__link">Tooling</a></li><li><a href="#compile" class="table-of-contents__link">Compile</a></li><li><a href="#schema" class="table-of-contents__link">Schema</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Related Documentation</div><ul class="footer__items"><li class="footer__item"><a href="https://cosmos.network/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://hub.cosmos.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.tendermint.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Tendermint Core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cosmwasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/wasmd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/wasmd<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm-plus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cosmwasm-plus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cawesome-wasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cawesome-wasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.cosmwasm.com/chat/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/CosmWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2021 CosmWasm</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ce7f4cbf.js"></script>
<script src="/assets/js/main.415ae867.js"></script>
</body>
</html>